<html>
<!--********************************************************************
'*
'*  File:           userquery.htm
'*  Created:        Augustus 2004
'*  Version:        1.0
'*  Author:         Marcel Jussen
'*
'*  Description:    NedCar user Management scripts.  
'*
'*  Copyright (C) 2004 KPN Telecom
'*
'********************************************************************-->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>UserQuery</title>
<link href="css/nedcarum.css" rel="stylesheet" type="text/css" />

<SCRIPT Language="VBScript">

Option Explicit

sub doRefresh
	Dim strUserName, strDomainName
	Dim sResult
	
	strUserName = trim(ucase(uname.value))
	uname.value = strUserName
	If strDomainName = "" Then strDomainName = "NEDCAR"
	
	call LookUpIDInfo(strDomainName, strUserName)
end sub

Function LookUpIDInfo(strDomainName, strUserName)
	Dim Result
	Dim rowNew, cellNew
	
	If strUserName <> "" Then
		call ListUserId(strDomainName, strUserName)
	else		
		call clearUserInfoTable()	
		set rowNew = tbUserinfo.InsertRow()
        	set cellNew = rowNew.InsertCell()
		cellnew.innerText = "User ID"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "No value entered!"
	end If	
	LookUpIDInfo=Result
End Function

sub clearUserInfoTable
  do while tbUserinfo.Rows.Length > 0
    tbUserinfo.deleteRow(tbUserinfo.Rows.Length - 1)
  loop
end sub


sub clearTables
  call clearUserInfoTable()
end sub

'function to list the properties of a user-account
Sub ListUserId(strDomainName, strUserName)
	dim Usr, sError
	Dim rowNew, cellNew				
	
	call clearUserInfoTable()
	
	' Add log entry
	AddToLog("Checking " & strDomainName & "\" & strUserName)
	
	On Error Resume Next
	Set Usr = GetObject("WinNT://" & strDomainName & "/" & strUserName & ",user")
	if err.number<0 then
		err.Clear
		call MsgBox("Could not find user " & strUserName & " in domain " & strDomainName, vbCritical, "Error") 
		' Add log entry
		AddToLog(strDomainName & "\" & strUserName & " could not be found.")
	else
		set rowNew = tbUserinfo.InsertRow()
        	set cellNew = rowNew.InsertCell()
		cellnew.innerText = "User ID"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = UCase(strUserName)
			
		set rowNew = tbUserinfo.InsertRow()
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "Fullname"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = usr.fullname
		
		' Add log entry
		AddToLog(strDomainName & "\" & strUserName & " " & usr.fullname)
						
		set rowNew = tbUserinfo.InsertRow()
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "Description/Department"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = usr.description
						
		set rowNew = tbUserinfo.InsertRow()
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "Home directory"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = usr.HomeDirectory			

		set rowNew = tbUserinfo.InsertRow()
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "Login script"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = usr.LoginScript			
			
		set rowNew = tbUserinfo.InsertRow()
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "Account disabled"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = usr.accountdisabled
						
		set rowNew = tbUserinfo.InsertRow()
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "Account expiration date"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = usr.AccountExpirationDate
			
		set rowNew = tbUserinfo.InsertRow()
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "Account locked"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = usr.AccountLocked							
		
		set rowNew = tbUserinfo.InsertRow()
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = "Password expiration date"
		set cellNew = rowNew.InsertCell()
		cellnew.innerText = usr.PasswordExpirationDate							
	end If
End Sub

Sub AddToLog(strText)
	const	ForAppend 	= 8
	const	LogFile		= "\\S100\LOGBOEK\NEDCARUM2\nedcarum2.log"
	const	htmSource	= "UserQuery"
	
	dim WshNetwork, fsoObj, f, strTemp
	dim strDomain, strComputer, strUsername
	dim strTime
	
	Set WshNetwork = CreateObject("WScript.Network")
	strComputer = WshNetwork.ComputerName
        strUsername = WshNetwork.UserName
	strTime = Now()
	
	Set fsoObj = CreateObject("Scripting.FileSystemObject")
   	Set f = fsoObj.OpenTextFile(LogFile, ForAppend, True)
   	strTemp = strTime & Chr(32) & htmSource & ", " & strComputer & ", " & strUsername & ", " & strText
   	f.WriteLine strTemp
   	f.Close
End Sub

</SCRIPT>

</head>

<body class="nedcarum">
<strong>User Query.</strong><br>
<br>
Please enter the user-id you wish to query.<br>
<br>
<table width="100%"  border="1" cellspacing="0" cellpadding="0">
  <tr>
    <th scope="row"><div align="left">
      <table  border=0 cellspacing="0" cellpadding="0">
        <tr>
          <th width="100" scope="row"><div align="left" class="nedcarum">User ID </div></th>
          <td width="250"><P>
              <INPUT name="uname" type="text" class="nedcarumform" id="uname" size="25" maxlength="25" onchange="doRefresh">
          </P></td>
          <td width="100"><P>
              <input name="lookup" type="BUTTON" id="lookup" onclick="doRefresh" value="Lookup"> 
              </P></td>
          <td width="100"><P>
              <input name="clear" type="BUTTON" id="clear" onclick="clearTables" value="Clear">
          </P></td>
          <td>&nbsp;</td>
        </tr>
      </table>
    </div></th>
  </tr>
</table>
<br>
<table width="100%"  border="1" cellspacing="0" cellpadding="0">
  <tr>
    <th scope="row"><div align="left"></div>
      <table width="100%" border="0" align="left" cellpadding="0" cellspacing="0" class="nedcarum">
      <THEAD>
        <TR>
          <TH width="25%" align="left" bgcolor="#000099"><span class="nedcarumtop"><strong>&nbsp;User information</strong></span></TH>
          <TH width="75%" align="left" bgcolor="#000099"><span class="nedcarumtop"><strong>&nbsp;</strong></span></TH>
        </TR>
      </THEAD>
      <TBODY ID = "tbUserinfo">
      </TBODY>
    </TABLE></th>
  </tr>
</table>
</body>
</html>